# .github/workflows/setup-labels.yml (æ”¾åœ¨æ¯å€‹ç›®æ¨™å€‰åº«ä¸­)
name: è¨­å®šå°ˆæ¡ˆ Labels

on:
  workflow_dispatch:  # æ‰‹å‹•è§¸ç™¼

  # å¯é¸ï¼šå€‰åº«å»ºç«‹æ™‚è‡ªå‹•åŸ·è¡Œ
  # create:

jobs:
  setup-labels:
    runs-on: ubuntu-latest
    name: è¨­å®šæ¨™æº– Labels

    steps:
      - name: è¨­å®š Labels
        uses: actions/github-script@v7
        with:
          script: |
            // æ¨™æº– Labels å®šç¾©
            const standardLabels = [
              // å€åŸŸåˆ†é¡
              { name: "area: engine", color: "1f77b4", description: "Issues or PRs related to core engine systems and architecture" },
              { name: "area: framework", color: "ff7f0e", description: "Issues or PRs related to application framework and base infrastructure" },
              { name: "area: gameplay", color: "2ca02c", description: "Issues or PRs related to gameplay" },
              { name: "area: subsystem", color: "d62728", description: "Issues or PRs related to modular subsystems and their integration" },
              { name: "area: third-party", color: "9467bd", description: "Issues or PRs related to third-party library integration and dependencies" },
            
              // éŒ¯èª¤åˆ†é¡
              { name: "bug: critical", color: "b60205", description: "Critical bugs that prevent the game from running or cause crashes" },
              { name: "bug: memory", color: "d73a4a", description: "Bugs related to memory leaks, allocation issues, or memory management" },
              { name: "bug: performance", color: "e99695", description: "Bugs related to performance issues, frame rate drops, or optimization" },
              { name: "bug: rendering", color: "f85149", description: "Bugs related to visual rendering" },
              { name: "bug: window-management", color: "ff6b6b", description: "Bugs related to window creation, positioning, or multi-window handling" },
            
              // å…¶ä»–
              { name: "build-system", color: "8b4513", description: "Issues related to build configuration, compilation, or deployment processes" },
              { name: "documentation", color: "0075ca", description: "Tasks related to documentation, comments, or knowledge sharing" },
            
              // åŠŸèƒ½åˆ†é¡
              { name: "feature: audio", color: "ff69b4", description: "Features related to audio system, sound effects, and music integration" },
              { name: "feature: gameplay", color: "32cd32", description: "Features related to core game mechanics, player interactions, and game logic" },
              { name: "feature: input", color: "ffa500", description: "Features related to input handling, controls, and user interaction systems" },
              { name: "feature: rendering", color: "00ced1", description: "Features related to graphics rendering, visual effects, and display systems" },
              { name: "feature: ui", color: "9370db", description: "Features related to user interface elements, menus, and HUD components" },
              { name: "feature: window-system", color: "20b2aa", description: "Features related to multi-window management, window creation, and window lifecycle" },
            
              // å¹³å°
              { name: "platform: windows", color: "0078d4", description: "Issues or features specific to Windows platform implementation" },
            
              // å„ªå…ˆç´š
              { name: "priority: urgent", color: "8b0000", description: "Urgent issues that need immediate attention and resolution" },
              { name: "priority: high", color: "dc143c", description: "High priority tasks that should be addressed soon" },
              { name: "priority: medium", color: "ffa500", description: "Medium priority tasks for regular development cycle" },
              { name: "priority: low", color: "90ee90", description: "Low priority tasks that can be addressed when time permits" },
            
              // ç‹€æ…‹
              { name: "status: planning", color: "fbca04", description: "Task is in planning phase, requirements gathering, or design stage" },
              { name: "status: in-progress", color: "0052cc", description: "Task is currently being worked on by a developer" },
              { name: "status: review", color: "5319e7", description: "Task is complete and awaiting code review or approval" },
              { name: "status: testing", color: "f9d0c4", description: "Task is complete and ready for testing or quality assurance" },
              { name: "status: blocked", color: "e99695", description: "Task is blocked and waiting for dependencies or external factors" },
              { name: "status: done", color: "0e8a16", description: "Task has been completed successfully" },
            
              // å·¥å…·
              { name: "tools", color: "6f42c1", description: "Tasks related to development tools, utilities, or workflow improvements" }
            ];

            console.log('ğŸš€ é–‹å§‹è¨­å®šæ¨™æº– Labels...');
            
            // ç²å–ç¾æœ‰ labels
            const { data: existingLabels } = await github.rest.issues.listLabelsForRepo({
              owner: context.repo.owner,
              repo: context.repo.repo,
            });
            
            const existingLabelNames = existingLabels.map(label => label.name);
            
            let created = 0;
            let updated = 0;
            let errors = 0;
            
            // å»ºç«‹æˆ–æ›´æ–°æ¯å€‹æ¨™æº– label
            for (const label of standardLabels) {
              try {
                if (existingLabelNames.includes(label.name)) {
                  // æ›´æ–°ç¾æœ‰ label
                  const existingLabel = existingLabels.find(l => l.name === label.name);
                  if (existingLabel.color !== label.color || existingLabel.description !== label.description) {
                    await github.rest.issues.updateLabel({
                      owner: context.repo.owner,
                      repo: context.repo.repo,
                      name: label.name,
                      color: label.color,
                      description: label.description
                    });
                    console.log(`âœï¸  æ›´æ–° label: ${label.name}`);
                    updated++;
                  } else {
                    console.log(`âœ… Label å·²æ˜¯æœ€æ–°: ${label.name}`);
                  }
                } else {
                  // å»ºç«‹æ–° label
                  await github.rest.issues.createLabel({
                    owner: context.repo.owner,
                    repo: context.repo.repo,
                    name: label.name,
                    color: label.color,
                    description: label.description
                  });
                  console.log(`â• å»ºç«‹ label: ${label.name}`);
                  created++;
                }
              } catch (error) {
                console.error(`âŒ è™•ç† label "${label.name}" æ™‚ç™¼ç”ŸéŒ¯èª¤:`, error.message);
                errors++;
              }
            }
            
            console.log('\nğŸ“Š Labels è¨­å®šçµæœ:');
            console.log(`  â• æ–°å»ºç«‹: ${created} å€‹`);
            console.log(`  âœï¸  å·²æ›´æ–°: ${updated} å€‹`);
            console.log(`  âŒ éŒ¯èª¤: ${errors} å€‹`);
            console.log(`  ğŸ“‹ ç¸½è¨ˆ: ${standardLabels.length} å€‹æ¨™æº– labels`);
            
            // ç”¢ç”Ÿæ‘˜è¦å ±å‘Š
            core.summary
              .addHeading('ğŸ·ï¸ Labels è¨­å®šçµæœ')
              .addTable([
                [{data: 'æ“ä½œ', header: true}, {data: 'æ•¸é‡', header: true}],
                ['æ–°å»ºç«‹', created.toString()],
                ['å·²æ›´æ–°', updated.toString()],
                ['éŒ¯èª¤', errors.toString()],
                ['ç¸½è¨ˆ', standardLabels.length.toString()]
              ])
              .write();